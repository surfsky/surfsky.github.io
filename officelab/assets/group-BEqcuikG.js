import{c as e,E as t,W as s,a as i,i as a}from"./WebHelper-Cm7Nj4uJ.js";class h{constructor(){this.data=[]}setData(e){this.data=e}getPreview(){return this.data.slice(0,10)}calcGroupData(e){if(!this.data.length)throw new Error("数据未准备就绪");if(!e||0===e.length)throw new Error("请选择要分组的列");const t=[],s=new Set;for(const i of this.data){const a=e.map(e=>i[e]).join("-");if(s.has(a)){const s=t.find(t=>t[e[0]]===i[e[0]]);s.count=(s.count||0)+1}else{s.add(a);const h={};e.forEach(e=>{h[e]=i[e]}),h.count=1,t.push(h)}}return t}}const n=e({data:()=>({tool:new h,file:null,sheets:[],sheet:"",columns:[],keyColumns:[],previewList:[],previewColumns:[],resultData:[],resultColumns:[],isProcessing:!1,currentPage:1,pageSize:10}),methods:{resetFile(){this.file=null,this.sheets=[],this.sheet="",this.columns=[],this.keyColumns=[],this.tool.setData([]),this.resetPreviewAndResult()},resetPreviewAndResult(){this.previewList=[],this.previewColumns=[],this.resultData=[],this.resultColumns=[]},async handleFileChange(e){this.resetFile(),this.file=e.raw,this.file&&(this.sheets=await i.getSheetNames(this.file),this.sheets.length>0&&(this.sheet=this.sheets[0],await this.onSheetChange(this.sheet)))},async onSheetChange(e){if(!this.file)return;this.columns=[],this.keyColumns=[],this.resetPreviewAndResult();const t=await i.readExcelFile(this.file,e);t.length>0?(this.columns=Object.keys(t[0]),this.tool.setData(t)):this.tool.setData([])},previewData(){if(!this.sheet)return void t.warning("请先选择Sheet");const e=this.tool.getPreview();this.previewList=e,this.previewColumns=e.length>0?Object.keys(e[0]).map(e=>({prop:e,label:e})):[]},findResultData(){this.isProcessing=!0,setTimeout(()=>{try{const e=this.tool.calcGroupData(this.keyColumns);this.resultData=e,e.length>0&&(this.resultColumns=Object.keys(e[0]).map(e=>({prop:e,label:e}))),t.success("完成")}catch(e){t.error(`失败: ${e.message}`)}finally{this.isProcessing=!1}},0)},exportResult(){if(0===this.resultData.length)return void t.warning("没有可导出的结果");const e=s.getExportFileName("分组结果.xlsx");i.exportExcel(this.resultData,e,!0)},handleSizeChange(e){this.pageSize=e,this.currentPage=1},handleCurrentChange(e){this.currentPage=e}},computed:{paginatedResult(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.resultData.slice(e,t)}}});n.use(a),n.mount("#app");
