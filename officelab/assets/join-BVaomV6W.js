import{c as e,E as t,W as s,a as i,i as a}from"./WebHelper-Cm7Nj4uJ.js";class h{constructor(){this.dataA=[],this.dataB=[]}setDataA(e){this.dataA=e}setDataB(e){this.dataB=e}getPreviewA(){return this.dataA.slice(0,10)}getPreviewB(){return this.dataB.slice(0,10)}leftJoin(e){if(!this.dataA.length||!this.dataB.length||!e.length)return this.dataA;const t=new Map;for(const i of this.dataB){const s=e.map(e=>i[e.keyB]).join("__");t.set(s,i)}const s=[];for(const i of this.dataA){const a=e.map(e=>i[e.keyA]).join("__"),h=t.get(a),l={...i},n=h?Object.keys(h):this.dataB.length>0?Object.keys(this.dataB[0]):[];for(const e of n){let t=e,s=1;for(;l.hasOwnProperty(t);)t=`${e}_${s++}`;l[t]=h?h[e]:void 0}s.push(l)}return s}getAvailableColumns(){const e=this.dataA.length>0?Object.keys(this.dataA[0]):[],t=this.dataB.length>0?Object.keys(this.dataB[0]):[],s=new Set(e);for(const i of t){let e=i,t=1;for(;s.has(e);)e=`${i}_${t++}`;s.add(e)}return Array.from(s)}}const l=e({data:()=>({joinTool:new h,fileA:null,fileB:null,sheetsA:[],sheetsB:[],sheetA:"",sheetB:"",columnsA:[],columnsB:[],keyPairs:[{keyA:"",keyB:""}],previewDataA:[],previewDataB:[],previewColumnsA:[],previewColumnsB:[],availableColumns:[],outputColumns:[],joinResult:[],resultColumns:[],isJoining:!1,currentPage:1,pageSize:10}),methods:{resetFileA(){this.fileA=null,this.sheetsA=[],this.sheetA="",this.columnsA=[],this.keyPairs=[{keyA:"",keyB:""}],this.joinTool.setDataA([]),this.resetPreviewAndResult()},resetFileB(){this.fileB=null,this.sheetsB=[],this.sheetB="",this.columnsB=[],this.keyPairs=[{keyA:"",keyB:""}],this.joinTool.setDataB([]),this.resetPreviewAndResult()},resetPreviewAndResult(){this.previewDataA=[],this.previewDataB=[],this.previewColumnsA=[],this.previewColumnsB=[],this.joinResult=[],this.resultColumns=[],this.availableColumns=[],this.outputColumns=[]},async handleFileAChange(e){this.resetFileA(),this.fileA=e.raw,this.fileA&&(this.sheetsA=await i.getSheetNames(this.fileA),this.sheetsA.length>0&&(this.sheetA=this.sheetsA[0],await this.onSheetAChange(this.sheetA)))},async handleFileBChange(e){this.resetFileB(),this.fileB=e.raw,this.fileB&&(this.sheetsB=await i.getSheetNames(this.fileB),this.sheetsB.length>0&&(this.sheetB=this.sheetsB[0],await this.onSheetBChange(this.sheetB)))},async onSheetAChange(e){if(!this.fileA)return;this.columnsA=[],this.resetPreviewAndResult();const t=await i.readExcelFile(this.fileA,e);this.joinTool.setDataA(t),t.length>0&&(this.columnsA=Object.keys(t[0])),this.updateAvailableColumns()},async onSheetBChange(e){if(!this.fileB)return;this.columnsB=[],this.resetPreviewAndResult();const t=await i.readExcelFile(this.fileB,e);this.joinTool.setDataB(t),t.length>0&&(this.columnsB=Object.keys(t[0])),this.updateAvailableColumns()},previewData(){this.previewDataA=this.joinTool.getPreviewA(),this.previewDataB=this.joinTool.getPreviewB(),this.previewColumnsA=this.previewDataA.length>0?Object.keys(this.previewDataA[0]).map(e=>({prop:e,label:e})):[],this.previewColumnsB=this.previewDataB.length>0?Object.keys(this.previewDataB[0]).map(e=>({prop:e,label:e})):[]},addKeyPair(){this.keyPairs.push({keyA:"",keyB:""})},removeKeyPair(e){this.keyPairs.splice(e,1)},updateAvailableColumns(){this.fileA&&this.fileB&&(this.availableColumns=this.joinTool.getAvailableColumns(),this.outputColumns=[...this.availableColumns])},joinData(){this.keyPairs.some(e=>!e.keyA||!e.keyB)?t.warning("请选择所有关联列"):(this.isJoining=!0,setTimeout(()=>{try{const e=this.joinTool.leftJoin(this.keyPairs).map(e=>{const t={};return this.outputColumns.forEach(s=>{e.hasOwnProperty(s)&&(t[s]=e[s])}),t});this.joinResult=e,e.length>0&&(this.resultColumns=Object.keys(e[0]).map(e=>({prop:e,label:e}))),t.success("关联完成")}catch(e){t.error(`关联失败: ${e.message}`)}finally{this.isJoining=!1}},0))},exportResult(){if(0===this.joinResult.length)return void t.warning("没有可导出的结果");const e=s.getExportFileName("关联结果.xlsx");i.exportExcel(this.joinResult,e,!0)},handleSizeChange(e){this.pageSize=e,this.currentPage=1},handleCurrentChange(e){this.currentPage=e}},computed:{paginatedResult(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.joinResult.slice(e,t)}}});l.use(a),l.mount("#app");
