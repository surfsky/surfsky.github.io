import{c as e,E as t,W as s,a as r,i}from"./WebHelper-Cm7Nj4uJ.js";class o{constructor(){this.data=[]}setData(e){this.data=e}getPreview(){return this.data.slice(0,10)}sort(e){if(!this.data.length)throw new Error("数据未准备就绪");if(!e||0===e.length)throw new Error("请设置排序规则");const t=[...this.data];return t.sort((t,s)=>{for(const r of e){const{column:e,order:i}=r,o=t[e],a=s[e];let h=0;if("string"==typeof o&&"string"==typeof a?h=o.localeCompare(a,"zh-CN"):o<a?h=-1:o>a&&(h=1),"custom"===i){const e=this.compareNumerically(o,a);0!==e&&(h=e)}if(0!==h)return"desc"===i?-h:h}return 0}),t}compareNumerically(e,t){const s=this.extractNumber(e),r=this.extractNumber(t);return null!==s&&null!==r?s-r:String(e).localeCompare(String(t),"zh-Hans-CN")}extractNumber(e){if("number"==typeof e)return e;if("string"==typeof e){const t=e.match(/\d+/);if(t)return parseInt(t[0],10)}return null}}const a=e({data:()=>({orderTool:new o,file:null,sheets:[],sheet:"",columns:[],sortRules:[],previewList:[],previewColumns:[],sortedData:[],resultColumns:[],isProcessing:!1,currentPage:1,pageSize:10}),methods:{resetFile(){this.file=null,this.sheets=[],this.sheet="",this.columns=[],this.sortRules=[],this.orderTool.setData([]),this.resetPreviewAndResult()},resetPreviewAndResult(){this.previewList=[],this.previewColumns=[],this.sortedData=[],this.resultColumns=[]},async handleFileChange(e){this.resetFile(),this.file=e.raw,this.file&&(this.sheets=await r.getSheetNames(this.file),this.sheets.length>0&&(this.sheet=this.sheets[0],await this.onSheetChange(this.sheet)))},async onSheetChange(e){if(!this.file)return;this.columns=[],this.sortRules=[],this.resetPreviewAndResult();const t=await r.readExcelFile(this.file,e);t.length>0?(this.columns=Object.keys(t[0]),this.orderTool.setData(t)):this.orderTool.setData([])},previewData(){if(!this.sheet)return void t.warning("请先选择Sheet");const e=this.orderTool.getPreview();this.previewList=e,this.previewColumns=e.length>0?Object.keys(e[0]).map(e=>({prop:e,label:e})):[]},addRule(){this.sortRules.push({column:"",order:"asc"})},removeRule(e){this.sortRules.splice(e,1)},moveRule(e,t){const s=e+t;if(s<0||s>=this.sortRules.length)return;const r=this.sortRules.splice(e,1)[0];this.sortRules.splice(s,0,r)},sortData(){this.isProcessing=!0,setTimeout(()=>{try{const e=this.orderTool.sort(this.sortRules);this.sortedData=e,e.length>0&&(this.resultColumns=Object.keys(e[0]).map(e=>({prop:e,label:e}))),t.success("排序完成")}catch(e){t.error(`排序失败: ${e.message}`)}finally{this.isProcessing=!1}},0)},exportResult(){if(0===this.sortedData.length)return void t.warning("没有可导出的结果");const e=s.getExportFileName("排序结果.xlsx");r.exportExcel(this.sortedData,e,!0)},handleSizeChange(e){this.pageSize=e,this.currentPage=1},handleCurrentChange(e){this.currentPage=e}},computed:{paginatedResult(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.sortedData.slice(e,t)}}});a.use(i),a.mount("#app");
