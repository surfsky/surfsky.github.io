import{c as e,E as t,W as s,a as i,i as a}from"./WebHelper-Cm7Nj4uJ.js";class h{constructor(){this.dataA=[],this.dataB=[]}setDataA(e){this.dataA=e}setDataB(e){this.dataB=e}getPreviewA(){return this.dataA.slice(0,10)}getPreviewB(){return this.dataB.slice(0,10)}compareByA(e,t){if(!this.dataA.length||!this.dataB.length)throw new Error("数据未准备就绪");const s=new Set(this.dataA.map(t=>t[e])),i=[...this.dataA.map(e=>({...e,"对比结果":"已存在"}))];for(const a of this.dataA)if(!this.dataB.some(s=>s[t]===a[e])){const t=i.findIndex(t=>t[e]===a[e]);-1!==t&&(i[t]["对比结果"]="删除")}for(const a of this.dataB)s.has(a[t])||i.push({...a,"对比结果":"新增"});return i}compareByB(e,t){if(!this.dataA.length||!this.dataB.length)throw new Error("数据未准备就绪");const s=new Set(this.dataA.map(t=>t[e])),i=[];for(const a of this.dataB)s.has(a[t])?i.push({...a,"对比结果":"更新"}):i.push({...a,"对比结果":"新增"});for(const a of this.dataA)this.dataB.some(s=>s[t]===a[e])||i.push({...a,"对比结果":"删除"});return i}}const r=e({data:()=>({comparerTool:new h,fileA:null,fileB:null,sheetsA:[],sheetsB:[],sheetA:"",sheetB:"",columnsA:[],columnsB:[],keyColumnA:"",keyColumnB:"",previewDataA:[],previewDataB:[],previewColumnsA:[],previewColumnsB:[],compareResult:[],resultColumns:[],isComparing:!1,currentPage:1,pageSize:10}),methods:{resetFileA(){this.fileA=null,this.sheetsA=[],this.sheetA="",this.columnsA=[],this.keyColumnA="",this.comparerTool.setDataA([]),this.resetPreviewAndResult()},resetFileB(){this.fileB=null,this.sheetsB=[],this.sheetB="",this.columnsB=[],this.keyColumnB="",this.comparerTool.setDataB([]),this.resetPreviewAndResult()},resetPreviewAndResult(){this.previewDataA=[],this.previewDataB=[],this.previewColumnsA=[],this.previewColumnsB=[],this.compareResult=[],this.resultColumns=[]},async handleFileAChange(e){this.resetFileA(),this.fileA=e.raw,this.fileA&&(this.sheetsA=await i.getSheetNames(this.fileA),this.sheetsA.length>0&&(this.sheetA=this.sheetsA[0],await this.onSheetAChange(this.sheetA)))},async handleFileBChange(e){this.resetFileB(),this.fileB=e.raw,this.fileB&&(this.sheetsB=await i.getSheetNames(this.fileB),this.sheetsB.length>0&&(this.sheetB=this.sheetsB[0],await this.onSheetBChange(this.sheetB)))},async onSheetAChange(e){if(!this.fileA)return;this.columnsA=[],this.keyColumnA="",this.resetPreviewAndResult();const t=await i.readExcelFile(this.fileA,e);t.length>0?(this.columnsA=Object.keys(t[0]),this.keyColumnA=this.columnsA[0],this.comparerTool.setDataA(t)):this.comparerTool.setDataA([])},async onSheetBChange(e){if(!this.fileB)return;this.columnsB=[],this.keyColumnB="",this.resetPreviewAndResult();const t=await i.readExcelFile(this.fileB,e);t.length>0?(this.columnsB=Object.keys(t[0]),this.keyColumnB=this.columnsB[0],this.comparerTool.setDataB(t)):this.comparerTool.setDataB([])},previewData(){this.previewDataA=this.comparerTool.getPreviewA(),this.previewDataB=this.comparerTool.getPreviewB(),this.previewColumnsA=this.previewDataA.length>0?Object.keys(this.previewDataA[0]).map(e=>({prop:e,label:e})):[],this.previewColumnsB=this.previewDataB.length>0?Object.keys(this.previewDataB[0]).map(e=>({prop:e,label:e})):[]},compareData(){this.isComparing=!0,setTimeout(()=>{try{const e=this.comparerTool.compareByB(this.keyColumnA,this.keyColumnB);this.compareResult=e,e.length>0&&(this.resultColumns=Object.keys(e[0]).map(e=>({prop:e,label:e}))),t.success("比对完成")}catch(e){t.error(`比对失败: ${e.message}`)}finally{this.isComparing=!1}},0)},exportResult(){if(0===this.compareResult.length)return void t.warning("没有可导出的结果");const e=s.getExportFileName("比对结果.xlsx");i.exportExcel(this.compareResult,e,!0)},handleSizeChange(e){this.pageSize=e,this.currentPage=1},handleCurrentChange(e){this.currentPage=e},handleSortChange({column:e,prop:t,order:s}){s&&this.compareResult.sort((e,i)=>{const a=e[t],h=i[t];return"ascending"===s?a>h?1:a<h?-1:0:a<h?1:a>h?-1:0})}},computed:{paginatedResult(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.compareResult.slice(e,t)}}});r.use(a),r.mount("#app");
