import{E as e}from"./ExcelTool-DCMHEXgk.js";class t{constructor(){this.dataA=[],this.dataB=[]}setDataA(e){this.dataA=e}setDataB(e){this.dataB=e}getPreviewA(){return this.dataA.slice(0,10)}getPreviewB(){return this.dataB.slice(0,10)}compare(e,t){if(!this.dataA.length||!this.dataB.length)throw new Error("数据未准备就绪");const s=new Set(this.dataA.map(t=>t[e])),i=[...this.dataA.map(e=>({...e,"对比结果":"已存在"}))];for(const a of this.dataA)if(!this.dataB.some(s=>s[t]===a[e])){const t=i.findIndex(t=>t[e]===a[e]);-1!==t&&(i[t]["对比结果"]="删除")}for(const a of this.dataB)s.has(a[t])||i.push({...a,"对比结果":"新增"});return i}}const{createApp:s}=Vue,{ElMessage:i}=ElementPlus,a=s({data:()=>({comparerTool:new t,fileA:null,fileB:null,sheetsA:[],sheetsB:[],sheetA:"",sheetB:"",columnsA:[],columnsB:[],keyColumnA:"",keyColumnB:"",previewDataA:[],previewDataB:[],previewColumnsA:[],previewColumnsB:[],compareResult:[],resultColumns:[],isComparing:!1,currentPage:1,pageSize:10}),methods:{resetFileA(){this.fileA=null,this.sheetsA=[],this.sheetA="",this.columnsA=[],this.keyColumnA="",this.comparerTool.setDataA([]),this.resetPreviewAndResult()},resetFileB(){this.fileB=null,this.sheetsB=[],this.sheetB="",this.columnsB=[],this.keyColumnB="",this.comparerTool.setDataB([]),this.resetPreviewAndResult()},resetPreviewAndResult(){this.previewDataA=[],this.previewDataB=[],this.previewColumnsA=[],this.previewColumnsB=[],this.compareResult=[],this.resultColumns=[]},async handleFileAChange(t){this.resetFileA(),this.fileA=t.raw,this.fileA&&(this.sheetsA=await e.getSheetNames(this.fileA),this.sheetsA.length>0&&(this.sheetA=this.sheetsA[0],await this.onSheetAChange(this.sheetA)))},async handleFileBChange(t){this.resetFileB(),this.fileB=t.raw,this.fileB&&(this.sheetsB=await e.getSheetNames(this.fileB),this.sheetsB.length>0&&(this.sheetB=this.sheetsB[0],await this.onSheetBChange(this.sheetB)))},async onSheetAChange(t){if(!this.fileA)return;this.columnsA=[],this.keyColumnA="",this.resetPreviewAndResult();const s=await e.readExcelFile(this.fileA,t);s.length>0?(this.columnsA=Object.keys(s[0]),this.keyColumnA=this.columnsA[0],this.comparerTool.setDataA(s)):this.comparerTool.setDataA([])},async onSheetBChange(t){if(!this.fileB)return;this.columnsB=[],this.keyColumnB="",this.resetPreviewAndResult();const s=await e.readExcelFile(this.fileB,t);s.length>0?(this.columnsB=Object.keys(s[0]),this.keyColumnB=this.columnsB[0],this.comparerTool.setDataB(s)):this.comparerTool.setDataB([])},previewData(){this.previewDataA=this.comparerTool.getPreviewA(),this.previewDataB=this.comparerTool.getPreviewB(),this.previewColumnsA=this.previewDataA.length>0?Object.keys(this.previewDataA[0]).map(e=>({prop:e,label:e})):[],this.previewColumnsB=this.previewDataB.length>0?Object.keys(this.previewDataB[0]).map(e=>({prop:e,label:e})):[]},compareData(){this.isComparing=!0,setTimeout(()=>{try{const e=this.comparerTool.compare(this.keyColumnA,this.keyColumnB);this.compareResult=e,e.length>0&&(this.resultColumns=Object.keys(e[0]).map(e=>({prop:e,label:e}))),i.success("比对完成")}catch(e){i.error(`比对失败: ${e.message}`)}finally{this.isComparing=!1}},0)},exportResult(){0!==this.compareResult.length?e.exportExcel(this.compareResult,"比对结果.xlsx",!0):i.warning("没有可导出的结果")},handleSizeChange(e){this.pageSize=e,this.currentPage=1},handleCurrentChange(e){this.currentPage=e},handleSortChange({column:e,prop:t,order:s}){s&&this.compareResult.sort((e,i)=>{const a=e[t],h=i[t];return"ascending"===s?a>h?1:a<h?-1:0:a<h?1:a>h?-1:0})}},computed:{paginatedResult(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.compareResult.slice(e,t)}}});a.use(ElementPlus),a.mount("#app");
