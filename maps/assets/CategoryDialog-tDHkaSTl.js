const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./map-B5t8AdmZ.js","./map-B37rMNOZ.css"])))=>i.map(i=>d[i]);
import{F as e,E as t,R as n,d as s,P as i,D as o,a as r,_ as a,N as l,b as c,T as d,I as h}from"./map-B5t8AdmZ.js";class p extends e{constructor(){super()}createControl(){const e=document.createElement("div");return e.style.display="flex",e.style.alignItems="center",e.style.gap="8px",this.checkbox=document.createElement("input"),this.checkbox.type="checkbox",this.checkbox.style.width="16px",this.checkbox.style.height="16px",this.checkbox.style.cursor="pointer",this.checkbox.style.accentColor="#007bff",this.checkbox.style.borderRadius="3px",e.appendChild(this.checkbox),e}bindEvents(){super.bindEvents(),this.checkbox.addEventListener("change",()=>{this.triggerChange()})}triggerChange(){this.changeCallback&&this.changeCallback(this.checkbox.checked),this.dispatchEvent(new CustomEvent("change",{detail:{checked:this.checkbox.checked},bubbles:!0}))}getValue(){return this.checkbox.checked}setValue(e){this.checkbox.checked=e}setDisabled(e){this.checkbox.disabled=e;return this.controlEl.style.opacity=e?"0.6":"1",this}setChecked(e){return this.setValue(e),this}onChange(e){return this.changeCallback=e,this}setCheckboxSize(e){return this.checkbox.style.width=`${e}px`,this.checkbox.style.height=`${e}px`,this}setCheckboxColor(e){return this.checkbox.style.accentColor=e,this}setGap(e){const t="number"==typeof e?`${e}px`:e;return this.controlEl.style.gap=t,this}isChecked(){return this.checkbox.checked}isDisabled(){return this.checkbox.disabled}getCheckboxElement(){return this.checkbox}static create(e,t){const n=new p;return e&&n.setLabel(e),void 0!==t&&n.setChecked(t),n}}customElements.define("x-checkboxfield",p);class u extends e{constructor(){super()}createControl(){const e=document.createElement("div");return e.style.display="flex",e.style.alignItems="center",e.style.gap="8px",this.colorDisplay=document.createElement("div"),this.colorDisplay.style.width="24px",this.colorDisplay.style.height="24px",this.colorDisplay.style.border="1px solid #ccc",this.colorDisplay.style.borderRadius="4px",this.colorDisplay.style.cursor="pointer",this.colorDisplay.style.backgroundColor="#ffffff",this.colorDisplay.style.flexShrink="0",this.colorDisplay.style.position="relative",this.colorDisplay.style.overflow="hidden",this.colorInput=document.createElement("input"),this.colorInput.type="color",this.colorInput.style.position="absolute",this.colorInput.style.top="0",this.colorInput.style.left="0",this.colorInput.style.width="100%",this.colorInput.style.height="100%",this.colorInput.style.opacity="0",this.colorInput.style.cursor="pointer",this.colorInput.style.border="none",this.colorInput.value="#000000",this.colorDisplay.appendChild(this.colorInput),e.appendChild(this.colorDisplay),e}bindEvents(){super.bindEvents(),this.colorInput.addEventListener("input",()=>{this.updateColorDisplay(),this.triggerChange()}),this.colorInput.addEventListener("change",()=>{this.updateColorDisplay(),this.triggerChange()}),this.colorDisplay.addEventListener("click",()=>{this.colorInput.focus(),this.colorInput.click()})}updateColorDisplay(){this.colorDisplay.style.backgroundColor=this.colorInput.value}triggerChange(){this.changeCallback&&this.changeCallback(this.colorInput.value),this.dispatchEvent(new CustomEvent("change",{detail:{color:this.colorInput.value},bubbles:!0}))}getValue(){return this.colorInput.value}setValue(e){this.colorInput.value=e,this.updateColorDisplay()}setDisabled(e){this.colorInput.disabled=e;this.controlEl.style.opacity=e?"0.6":"1",this.colorDisplay.style.cursor=e?"not-allowed":"pointer",this.colorInput.style.cursor=e?"not-allowed":"pointer"}setColor(e){return this.setValue(e),this}onChange(e){return this.changeCallback=e,this}setColorDisplaySize(e){return this.colorDisplay.style.width=`${e}px`,this.colorDisplay.style.height=`${e}px`,this}setColorDisplayBorder(e){return this.colorDisplay.style.border=e,this}getColor(){return this.colorInput.value}isDisabled(){return this.colorInput.disabled}getColorInputElement(){return this.colorInput}getColorDisplayElement(){return this.colorDisplay}static create(e,t){const n=new u;return e&&n.setLabel(e),t&&n.setColor(t),n}}customElements.define("x-colorfield",u);class g extends t{constructor(){super(),this.selectedIcon="",this.iconList=[],this.labelText="",this.columns=6,this.iconSize=24,this.createElements(),this.bindEvents(),this.applyIconListStyles()}createElements(){this.style.display="flex",this.style.flexDirection="column",this.style.gap="8px",this.label=document.createElement("label"),this.label.style.fontSize="14px",this.label.style.color="#333",this.label.style.margin="0",this.label.style.fontWeight="500",this.iconContainer=document.createElement("div"),this.iconContainer.style.display="grid",this.iconContainer.style.gap="4px",this.iconContainer.style.padding="8px",this.iconContainer.style.border="1px solid #e0e6ed",this.iconContainer.style.borderRadius="4px",this.iconContainer.style.backgroundColor="#ffffff",this.iconContainer.style.maxHeight="200px",this.iconContainer.style.overflowY="auto",this.appendChild(this.label),this.appendChild(this.iconContainer)}bindEvents(){this.iconContainer.addEventListener("click",e=>{const t=e.target.closest(".icon-item");if(t){const e=t.dataset.iconName;e&&this.selectIcon(e)}})}applyIconListStyles(){this.updateGridColumns()}updateGridColumns(){this.iconContainer.style.gridTemplateColumns=`repeat(${this.columns}, 1fr)`}createIconElement(e){const t=document.createElement("div");if(t.className="icon-item",t.dataset.iconName=e.name,t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=`${this.iconSize+8}px`,t.style.height=`${this.iconSize+8}px`,t.style.border="1px solid transparent",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.transition="all 0.2s ease",t.style.backgroundColor="transparent",t.title=e.title||e.name,e.className.startsWith("/")||e.className.startsWith("http")){const n=document.createElement("img");n.src=e.className,n.style.width=`${this.iconSize}px`,n.style.height=`${this.iconSize}px`,n.style.objectFit="contain",n.style.pointerEvents="none",n.alt=e.title||e.name,t.appendChild(n)}else{const n=document.createElement("i");n.className=e.className,n.style.fontSize=`${this.iconSize}px`,n.style.color=e.color||"#333",n.style.pointerEvents="none",t.appendChild(n)}return t.addEventListener("mouseenter",()=>{t.style.backgroundColor="#f8f9fa",t.style.borderColor="#dee2e6"}),t.addEventListener("mouseleave",()=>{e.name!==this.selectedIcon&&(t.style.backgroundColor="transparent",t.style.borderColor="transparent")}),t}updateIconSelection(){this.iconContainer.querySelectorAll(".icon-item").forEach(e=>{const t=e;t.dataset.iconName===this.selectedIcon?(t.style.backgroundColor="#e3f2fd",t.style.borderColor="#2196f3",t.style.boxShadow="0 0 0 2px rgba(33, 150, 243, 0.2)"):(t.style.backgroundColor="transparent",t.style.borderColor="transparent",t.style.boxShadow="none")})}selectIcon(e){this.selectedIcon=e,this.updateIconSelection(),this.triggerChange()}triggerChange(){this.changeCallback&&this.changeCallback(this.selectedIcon),this.dispatchEvent(new CustomEvent("change",{detail:{selectedIcon:this.selectedIcon},bubbles:!0}))}setLabel(e){return this.labelText=e,this.label.textContent=e,this}setIconList(e){return this.iconList=e,this.renderIcons(),this}addIcon(e){return this.iconList.push(e),this.renderIcons(),this}setSelectedIcon(e){return this.selectedIcon=e,this.updateIconSelection(),this}setColumns(e){return this.columns=Math.max(1,e),this.updateGridColumns(),this}setIconSize(e){return this.iconSize=Math.max(12,e),this.renderIcons(),this}setMaxHeight(e){const t="number"==typeof e?`${e}px`:e;return this.iconContainer.style.maxHeight=t,this}onChange(e){return this.changeCallback=e,this}setLabelColor(e){return this.label.style.color=e,this}setLabelFontSize(e){return this.label.style.fontSize=e,this}setContainerBorder(e){return this.iconContainer.style.border=e,this}setContainerBackground(e){return this.iconContainer.style.backgroundColor=e,this}renderIcons(){this.iconContainer.innerHTML="",this.iconList.forEach(e=>{const t=this.createIconElement(e);this.iconContainer.appendChild(t)}),this.updateIconSelection()}getSelectedIcon(){return this.selectedIcon}getIconList(){return[...this.iconList]}getLabel(){return this.labelText}getColumns(){return this.columns}getIconSize(){return this.iconSize}getLabelElement(){return this.label}getIconContainerElement(){return this.iconContainer}static create(e,t){const n=new g;return e&&n.setLabel(e),t&&n.setIconList(t),n}static createWithPresetIcons(e){return g.create(e,[{name:"marker",className:"fas fa-map-marker-alt",title:"标记",color:"#ff4444"},{name:"home",className:"fas fa-home",title:"家",color:"#4CAF50"},{name:"work",className:"fas fa-briefcase",title:"工作",color:"#2196F3"},{name:"school",className:"fas fa-graduation-cap",title:"学校",color:"#FF9800"},{name:"hospital",className:"fas fa-hospital",title:"医院",color:"#F44336"},{name:"restaurant",className:"fas fa-utensils",title:"餐厅",color:"#795548"},{name:"shopping",className:"fas fa-shopping-cart",title:"购物",color:"#E91E63"},{name:"gas-station",className:"fas fa-gas-pump",title:"加油站",color:"#607D8B"},{name:"bank",className:"fas fa-university",title:"银行",color:"#3F51B5"},{name:"park",className:"fas fa-tree",title:"公园",color:"#4CAF50"},{name:"gym",className:"fas fa-dumbbell",title:"健身房",color:"#FF5722"},{name:"cinema",className:"fas fa-film",title:"电影院",color:"#9C27B0"}])}}customElements.define("x-iconlistfield",g);class x extends n{constructor(e="horizontal"){super(),this.orientation=e,this.panels=[],this.splitters=[],this.sizes=[],this.minSizes=[],this.isDragging=!1,this.currentSplitterIndex=-1,this.startPosition=0,this.startSizes=[],this.initStyles(),this.bindEvents()}initStyles(){this.style.display="flex",this.style.flexDirection="horizontal"===this.orientation?"row":"column",this.style.width="100%",this.style.height="100%",this.style.overflow="hidden"}bindEvents(){document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this))}addPanel(e,t,n=100){const s=document.createElement("div");if(s.className="split-panel-item",s.style.display="flex",s.style.flexDirection="column",s.style.overflow="hidden",s.appendChild(e),this.panels.length>0){const e=this.createSplitter();this.appendChild(e),this.splitters.push(e)}if(this.appendChild(s),this.panels.push(s),this.minSizes.push(n),void 0!==t)this.sizes.push(t);else{const e=this.panels.length;this.sizes=new Array(e).fill(100/e)}return this.updateLayout(),this}removePanel(e){if(e<0||e>=this.panels.length)return this;if(this.panels[e].remove(),this.panels.splice(e,1),this.sizes.splice(e,1),this.minSizes.splice(e,1),e<this.splitters.length)this.splitters[e].remove(),this.splitters.splice(e,1);else if(this.splitters.length>0){const e=this.splitters.pop();null==e||e.remove()}if(this.panels.length>0){const e=this.sizes.reduce((e,t)=>e+t,0);this.sizes=this.sizes.map(t=>t/e*100)}return this.updateLayout(),this}clearPanels(){return this.panels.forEach(e=>e.remove()),this.splitters.forEach(e=>e.remove()),this.panels=[],this.splitters=[],this.sizes=[],this.minSizes=[],this}createSplitter(){const e=document.createElement("div");return e.className="split-panel-splitter",e.style.backgroundColor="#e0e6ed",e.style.flexShrink="0",e.style.userSelect="none",e.style.position="relative","horizontal"===this.orientation?(e.style.width="4px",e.style.cursor="col-resize",e.style.height="100%"):(e.style.height="4px",e.style.cursor="row-resize",e.style.width="100%"),e.addEventListener("mouseenter",()=>{e.style.backgroundColor="#007bff"}),e.addEventListener("mouseleave",()=>{this.isDragging||(e.style.backgroundColor="#e0e6ed")}),e.addEventListener("mousedown",e=>{this.handleSplitterMouseDown(e,this.splitters.length)}),e}handleSplitterMouseDown(e,t){e.preventDefault(),this.isDragging=!0,this.currentSplitterIndex=t,this.startPosition="horizontal"===this.orientation?e.clientX:e.clientY,this.startSizes=[...this.sizes],document.body.style.cursor="horizontal"===this.orientation?"col-resize":"row-resize",document.body.style.userSelect="none"}handleMouseMove(e){if(!this.isDragging||this.currentSplitterIndex<0)return;const t=("horizontal"===this.orientation?e.clientX:e.clientY)-this.startPosition,n="horizontal"===this.orientation?this.clientWidth:this.clientHeight;if(0===n)return;const s=t/n*100,i=[...this.startSizes],o=this.currentSplitterIndex,r=this.currentSplitterIndex+1;if(o>=0&&r<i.length){const e=this.minSizes[o]/n*100,t=this.minSizes[r]/n*100,a=Math.max(e,this.startSizes[o]+s),l=Math.max(t,this.startSizes[r]-s);a>=e&&l>=t&&(i[o]=a,i[r]=l,this.sizes=i,this.updateLayout())}}handleMouseUp(){this.isDragging&&(this.isDragging=!1,this.currentSplitterIndex=-1,document.body.style.cursor="",document.body.style.userSelect="",this.splitters.forEach(e=>{e.style.backgroundColor="#e0e6ed"}))}updateLayout(){this.panels.forEach((e,t)=>{const n=this.sizes[t]||0;"horizontal"===this.orientation?(e.style.width=`${n}%`,e.style.height="100%"):(e.style.height=`${n}%`,e.style.width="100%")})}setOrientation(e){return this.orientation=e,this.style.flexDirection="horizontal"===e?"row":"column",this.splitters.forEach(t=>{"horizontal"===e?(t.style.width="4px",t.style.height="100%",t.style.cursor="col-resize"):(t.style.height="4px",t.style.width="100%",t.style.cursor="row-resize")}),this.updateLayout(),this}setPanelSizes(e){return e.length===this.panels.length&&(this.sizes=[...e],this.updateLayout()),this}getPanelSizes(){return[...this.sizes]}getPanelCount(){return this.panels.length}getPanel(e){return this.panels[e]||null}resetToEqualSizes(){if(this.panels.length>0){const e=100/this.panels.length;this.sizes=new Array(this.panels.length).fill(e),this.updateLayout()}return this}destroy(){document.removeEventListener("mousemove",this.handleMouseMove.bind(this)),document.removeEventListener("mouseup",this.handleMouseUp.bind(this)),this.clearPanels(),this.remove()}}customElements.define("x-splitpanel",x);class y extends n{constructor(){super(),this.nodes=[],this.selectedNode=null,this.createTree()}createTree(){this.container=document.createElement("div"),this.container.className="tree-container",this.container.style.cssText="\n            width: 100%;\n            height: 100%;\n            overflow-y: auto;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            line-height: 1.4;\n        ",this.appendChild(this.container),this.injectStyles()}injectStyles(){const e="tree-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n            .tree-node {\n                user-select: none;\n                cursor: pointer;\n            }\n            \n            .tree-node-content {\n                display: flex;\n                align-items: center;\n                padding: 4px 8px;\n                border-radius: 4px;\n                transition: background-color 0.15s ease;\n            }\n            \n            .tree-node-content:hover {\n                background-color: #f5f5f5;\n            }\n            \n            .tree-node-content.selected {\n                background-color: #e3f2fd;\n                color: #1976d2;\n            }\n            \n            .tree-node-expand {\n                width: 16px;\n                height: 16px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                margin-right: 4px;\n                font-size: 12px;\n                color: #666;\n                transition: transform 0.15s ease;\n            }\n            \n            .tree-node-expand.expanded {\n                transform: rotate(90deg);\n            }\n            \n            .tree-node-expand.empty {\n                visibility: hidden;\n            }\n            \n            .tree-node-icon {\n                width: 16px;\n                height: 16px;\n                margin-right: 6px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 14px;\n            }\n            \n            .tree-node-label {\n                flex: 1;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            \n            .tree-node-children {\n                margin-left: 20px;\n                display: none;\n            }\n            \n            .tree-node-children.expanded {\n                display: block;\n            }\n        ",document.head.appendChild(t)}setData(e){return this.nodes=e,this.render(),this}getData(){return this.nodes}render(){this.container.innerHTML="",this.nodes.forEach(e=>{this.container.appendChild(this.createNodeElement(e))})}createNodeElement(e){const t=document.createElement("div");t.className="tree-node",t.dataset.nodeId=e.id;const n=document.createElement("div");n.className="tree-node-content",e.selected&&n.classList.add("selected");const s=document.createElement("div");s.className="tree-node-expand",e.children&&e.children.length>0?(s.textContent="▶",e.expanded&&s.classList.add("expanded"),s.addEventListener("click",t=>{t.stopPropagation(),this.toggleNode(e)})):s.classList.add("empty");const i=document.createElement("div");i.className="tree-node-icon",i.textContent=e.children&&e.children.length>0?"📁":"📄";const o=document.createElement("div");if(o.className="tree-node-label",o.textContent=e.label,n.appendChild(s),n.appendChild(i),n.appendChild(o),t.appendChild(n),n.addEventListener("click",()=>{this.selectNode(e)}),e.children&&e.children.length>0){const n=document.createElement("div");n.className="tree-node-children",e.expanded&&n.classList.add("expanded"),e.children.forEach(e=>{n.appendChild(this.createNodeElement(e))}),t.appendChild(n)}return t}toggleNode(e){var t;e.expanded=!e.expanded;const n=this.container.querySelector(`.tree-node[data-node-id="${e.id}"]`);if(n){const t=n.querySelector(".tree-node-expand"),s=n.querySelector(".tree-node-children");t&&t.classList.toggle("expanded",e.expanded),s&&s.classList.toggle("expanded",e.expanded)}null==(t=this.onNodeExpand)||t.call(this,e),this.dispatchEvent(new CustomEvent("toggle",{detail:{node:e,isExpanded:e.expanded}}))}selectNode(e){var t;if(this.selectedNode===e)return;if(this.selectedNode){this.selectedNode.selected=!1;const e=this.container.querySelector(`.tree-node[data-node-id="${this.selectedNode.id}"] > .tree-node-content`);e&&e.classList.remove("selected")}e.selected=!0,this.selectedNode=e;const n=this.container.querySelector(`.tree-node[data-node-id="${e.id}"] > .tree-node-content`);n&&n.classList.add("selected"),null==(t=this.onNodeSelect)||t.call(this,e)}getSelectedNode(){return this.selectedNode}onSelect(e){return this.onNodeSelect=e,this}onExpand(e){return this.onNodeExpand=e,this}addNode(e,t){if(null===e)this.nodes.push(t),this.container.appendChild(this.createNodeElement(t));else{const n=this.findNode(e);if(n){n.children||(n.children=[]),n.children.push(t),n.expanded=!0;const s=this.container.querySelector(`.tree-node[data-node-id="${e}"]`);if(s){let e=s.querySelector(".tree-node-children");e||(e=document.createElement("div"),e.className="tree-node-children",s.appendChild(e)),e.appendChild(this.createNodeElement(t)),e.classList.add("expanded");const n=s.querySelector(".tree-node-expand");n&&(n.classList.add("expanded"),n.textContent="▶")}}}return this}removeNode(e){const t=this.container.querySelector(`.tree-node[data-node-id="${e}"]`);return t&&t.remove(),this.nodes=this.removeNodeRecursive(this.nodes,e),this}removeNodeRecursive(e,t){return e.filter(e=>e.id!==t&&(e.children&&(e.children=this.removeNodeRecursive(e.children,t)),!0))}findNode(e){return this.findNodeRecursive(this.nodes,e)}findNodeRecursive(e,t){for(const n of e){if(n.id===t)return n;if(n.children){const e=this.findNodeRecursive(n.children,t);if(e)return e}}return null}expandAll(){return this.expandAllRecursive(this.nodes),this.render(),this}expandAllRecursive(e){e.forEach(e=>{e.children&&e.children.length>0&&(e.expanded=!0,this.expandAllRecursive(e.children))})}collapseAll(){return this.collapseAllRecursive(this.nodes),this.render(),this}collapseAllRecursive(e){e.forEach(e=>{e.expanded=!1,e.children&&this.collapseAllRecursive(e.children)})}static create(e){const t=new y;return e&&t.setData(e),t}}customElements.define("x-tree",y);const f=class e{constructor(){this.popup=null,this.splitPanel=null,this.categoryListPanel=null,this.categoryDetailContainer=null,this.selectedCategory=null,this.categoryNameField=null,this.categoryTree=null,this.expandedNodes=new Set(["-1"]),s.initCategories()}static show(e){const t=this.getInstance();t.onConfigChanged=e,t.show()}static getInstance(){return this.instance||(this.instance=new e),this.instance}static hide(){this.getInstance().hide()}setConfig(e){var t;(null==(t=this.popup)?void 0:t.isVisible())&&this.updateContent()}createPopup(){if(this.popup)return;this.popup=new i({title:"目录设置",isModal:!0,isDraggable:!0,dock:o.C,sizeConstraints:{minWidth:"800px",minHeight:"600px",maxWidth:"1200px",maxHeight:"800px"},onClose:()=>{this.hide()}}),this.popup.addToolbarButton("+ 新增目录",()=>this.addNewCategory());const e=this.popup.addToolbarButton("上移",()=>this.moveCategoryUp()),t=document.createElement("i");t.className="fas fa-arrow-up",t.style.marginRight="4px",e.prepend(t);const n=this.popup.addToolbarButton("下移",()=>this.moveCategoryDown()),s=document.createElement("i");s.className="fas fa-arrow-down",s.style.marginRight="4px",n.prepend(s);const r=this.popup.addToolbarButton("删除目录",()=>{this.selectedCategory&&this.deleteCategory(this.selectedCategory)});r.style.backgroundColor="#f44336",r.style.color="white",r.classList.add("delete-button");const a=this.popup.addToolbarButton("保存",()=>this.saveSettings());a.style.backgroundColor="#2196F3",a.style.color="white",a.classList.add("save-button"),this.injectButtonStyles(),this.splitPanel=new x("horizontal");const l=document.createElement("div");l.style.display="flex",l.style.flexDirection="column",l.style.gap="12px",l.style.height="100%",l.style.padding="16px",l.style.backgroundColor="#ffffff",l.style.border="1px solid #e0e6ed",l.style.overflowY="auto";const c=document.createElement("h4");c.textContent="目录列表",c.style.margin="0 0 8px 0",c.style.fontSize="14px",c.style.fontWeight="600",c.style.color="#333",this.categoryTree=new y,this.categoryTree.style.flex="1",this.categoryTree.style.border="1px solid #e0e6ed",this.categoryTree.style.borderRadius="4px",this.categoryTree.style.backgroundColor="#ffffff",this.categoryTree.onSelect(e=>{this.selectCategory(e.id)}),this.categoryTree.addEventListener("toggle",e=>{const{node:t,isExpanded:n}=e.detail;n?this.expandedNodes.add(t.id):this.expandedNodes.delete(t.id)}),l.appendChild(c),l.appendChild(this.categoryTree);const d=document.createElement("div");d.style.display="flex",d.style.flexDirection="column",d.style.gap="12px",d.style.height="100%",d.style.padding="16px",d.style.backgroundColor="#ffffff",d.style.border="1px solid #e0e6ed",d.style.overflowY="auto";const h=document.createElement("h4");h.textContent="目录详情",h.style.margin="0 0 8px 0",h.style.fontSize="14px",h.style.fontWeight="600",h.style.color="#333",this.categoryDetailContainer=document.createElement("div"),this.categoryDetailContainer.style.flex="1",this.categoryDetailContainer.style.overflowY="auto",this.categoryDetailContainer.innerHTML='<div style="text-align: center; color: #999; padding: 40px 20px;">请选择左侧目录查看详情</div>',this.categoryDetailContainer.id="categoryDetailContainer",d.appendChild(h),d.appendChild(this.categoryDetailContainer),this.splitPanel.addPanel(l,30,200),this.splitPanel.addPanel(d,70,300),this.splitPanel&&this.popup.setContent(this.splitPanel)}async findCategoryByName(e){return(await s.getConfig()).categories.find(t=>t.name===e)}injectButtonStyles(){const e="category-dialog-button-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n            .popup-toolbar-button.delete-button:hover {\n                background-color: #d32f2f !important;\n            }\n            .popup-toolbar-button.save-button:hover {\n                background-color: #1976D2 !important;\n            }\n        ",document.head.appendChild(t)}injectStyles(){const e="setting-panel-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n            .settings-btn {\n                width: 28px;\n                height: 28px;\n                border-radius: 4px;\n                border: 1px solid #ddd;\n                background: #f8f9fa;\n                color: #495057;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 14px;\n                transition: all 0.2s ease;\n                flex-shrink: 0;\n                background-image: url('/assets/icon/settings.svg');\n                background-repeat: no-repeat;\n                background-position: center;\n                background-size: 16px 16px;\n            }\n\n            .settings-btn:hover {\n                background-color: #e9ecef;\n                border-color: #adb5bd;\n                transform: scale(1.05);\n            }\n\n            .settings-btn:active {\n                transform: scale(0.95);\n            }\n\n            .settings-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.5);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 20000;\n                opacity: 0;\n                visibility: hidden;\n                transition: opacity 0.3s ease, visibility 0.3s ease;\n                box-sizing: border-box;\n                padding: 20px;\n            }\n\n            .settings-modal.show {\n                opacity: 1;\n                visibility: visible;\n            }\n\n            .settings-modal-content {\n                background: white;\n                border-radius: 12px;\n                width: 90%;\n                max-width: 600px;\n                max-height: 85vh;\n                overflow: hidden;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);\n                display: flex;\n                flex-direction: column;\n            }\n\n            .settings-modal-header {\n                padding: 24px 24px 20px 24px;\n                border-bottom: 1px solid #f0f0f0;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);\n                flex-shrink: 0;\n            }\n\n            .settings-modal-header h3 {\n                margin: 0;\n                color: #2c3e50;\n                font-size: 20px;\n                font-weight: 600;\n            }\n\n            .header-actions {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n            }\n\n            .add-category-btn {\n                padding: 8px 16px;\n                border: 1px solid #007bff;\n                background: #007bff;\n                color: white;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 13px;\n                font-weight: 500;\n                transition: all 0.2s ease;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n\n            .add-category-btn:hover {\n                background: #0056b3;\n                border-color: #0056b3;\n                transform: translateY(-1px);\n                box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);\n            }\n\n            .settings-modal-close {\n                background: none;\n                border: none;\n                font-size: 24px;\n                cursor: pointer;\n                color: #666;\n                padding: 0;\n                width: 30px;\n                height: 30px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border-radius: 50%;\n                transition: all 0.2s ease;\n            }\n\n            .settings-modal-close:hover {\n                background: #f8f9fa;\n                color: #333;\n            }\n\n            .settings-modal-body {\n                padding: 24px;\n                overflow-y: auto;\n                flex: 1;\n                background: #fafbfc;\n            }\n\n            .category-setting {\n                padding: 20px;\n                margin-bottom: 16px;\n                border-radius: 8px;\n                background: white;\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);\n                border: 1px solid #f0f0f0;\n                transition: all 0.2s ease;\n            }\n\n            .category-setting:hover {\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n                border-color: #e0e6ed;\n            }\n\n            .category-setting:last-child {\n                margin-bottom: 0;\n            }\n\n            .category-setting-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                margin-bottom: 16px;\n                padding-bottom: 12px;\n                border-bottom: 1px solid #f0f0f0;\n                transition: all 0.2s ease;\n            }\n\n            .category-setting-header:hover {\n                background: rgba(0, 123, 255, 0.05);\n                border-radius: 6px;\n                margin: -6px;\n                padding: 6px 6px 18px 6px;\n            }\n\n            .category-name {\n                font-weight: 600;\n                color: #2c3e50;\n                font-size: 16px;\n                flex: 1;\n            }\n\n            .category-header-buttons {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .category-delete-btn,\n            .category-toggle-btn {\n                background: none;\n                border: none;\n                cursor: pointer;\n                padding: 6px;\n                border-radius: 4px;\n                font-size: 14px;\n                transition: all 0.2s ease;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                min-width: 28px;\n                height: 28px;\n            }\n\n            .category-delete-btn:hover {\n                background: #fee;\n                color: #dc3545;\n                transform: scale(1.1);\n            }\n\n            .category-toggle-btn:hover {\n                background: #e3f2fd;\n                color: #007bff;\n                transform: scale(1.1);\n            }\n\n            .category-setting.expanded .category-controls {\n                animation: slideDown 0.3s ease;\n            }\n\n            @keyframes slideDown {\n                from {\n                    opacity: 0;\n                    transform: translateY(-10px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0);\n                }\n            }\n\n            .category-controls {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 20px;\n                margin-top: 16px;\n            }\n\n            .control-group {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                position: relative;\n            }\n\n            .control-label {\n                font-size: 13px;\n                font-weight: 600;\n                color: #495057;\n                margin-bottom: 6px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n\n            .control-label::before {\n                content: '';\n                width: 3px;\n                height: 12px;\n                background: linear-gradient(135deg, #007bff, #0056b3);\n                border-radius: 2px;\n            }\n\n            /* 输入框容器样式 */\n            .input-container {\n                position: relative;\n                display: flex;\n                align-items: center;\n            }\n\n            .input-unit {\n                position: absolute;\n                right: 12px;\n                font-size: 12px;\n                color: #6c757d;\n                font-weight: 500;\n                pointer-events: none;\n                background: rgba(255, 255, 255, 0.9);\n                padding: 2px 4px;\n                border-radius: 3px;\n            }\n\n            .text-style-select,\n            .text-size-input,\n            .text-stroke-width-input,\n            .icon-size-input {\n                padding: 10px 14px;\n                border: 2px solid #e8ecef;\n                border-radius: 8px;\n                font-size: 14px;\n                font-weight: 500;\n                transition: all 0.3s ease;\n                background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);\n                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);\n            }\n\n            .text-style-select:focus,\n            .text-size-input:focus,\n            .text-stroke-width-input:focus,\n            .icon-size-input:focus {\n                outline: none;\n                border-color: #007bff;\n                box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.15), 0 4px 12px rgba(0, 123, 255, 0.1);\n                transform: translateY(-1px);\n            }\n\n            .text-size-input,\n            .text-stroke-width-input,\n            .icon-size-input {\n                width: 100%;\n                text-align: center;\n                font-weight: 600;\n                color: #2c3e50;\n            }\n\n            .text-size-input:hover,\n            .text-stroke-width-input:hover,\n            .icon-size-input:hover {\n                border-color: #b8c5d1;\n                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);\n            }\n\n            /* 数字输入框的增减按钮样式 */\n            .text-size-input::-webkit-outer-spin-button,\n            .text-size-input::-webkit-inner-spin-button,\n            .text-stroke-width-input::-webkit-outer-spin-button,\n            .text-stroke-width-input::-webkit-inner-spin-button,\n            .icon-size-input::-webkit-outer-spin-button,\n            .icon-size-input::-webkit-inner-spin-button {\n                -webkit-appearance: none;\n                margin: 0;\n            }\n\n            .text-size-input[type=number],\n             .text-stroke-width-input[type=number],\n             .icon-size-input[type=number] {\n                 -moz-appearance: textfield;\n             }\n\n             /* 输入框动画效果 */\n             .text-size-input:focus + .input-unit,\n             .text-stroke-width-input:focus + .input-unit,\n             .icon-size-input:focus + .input-unit {\n                 color: #007bff;\n                 transform: scale(1.1);\n                 font-weight: 600;\n             }\n\n             /* 复选框样式 */\n             .text-bold-input {\n                 width: 18px;\n                 height: 18px;\n                 cursor: pointer;\n                 accent-color: #007bff;\n                 transform: scale(1.2);\n             }\n\n             .text-bold-input:hover {\n                 transform: scale(1.3);\n             }\n\n             /* 颜色选择器样式 */\n             .text-color-input,\n             .text-stroke-color-input {\n                 width: 60px;\n                 height: 40px;\n                 border: 2px solid #e8ecef;\n                 border-radius: 8px;\n                 cursor: pointer;\n                 background: none;\n                 transition: all 0.3s ease;\n                 box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);\n             }\n\n             .text-color-input:hover,\n             .text-stroke-color-input:hover {\n                 border-color: #b8c5d1;\n                 box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);\n                 transform: translateY(-1px);\n             }\n\n             .text-color-input:focus,\n             .text-stroke-color-input:focus {\n                 outline: none;\n                 border-color: #007bff;\n                 box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.15), 0 4px 12px rgba(0, 123, 255, 0.1);\n             }\n\n             /* 输入框值变化时的动画 */\n             .text-size-input:valid,\n             .icon-size-input:valid {\n                 background: linear-gradient(145deg, #f8fff8 0%, #f0f8f0 100%);\n             }\n\n             /* 输入框错误状态 */\n             .text-size-input:invalid,\n             .icon-size-input:invalid {\n                 border-color: #dc3545;\n                 background: linear-gradient(145deg, #fff8f8 0%, #fdf2f2 100%);\n             }\n\n             .text-size-input:invalid + .input-unit,\n             .icon-size-input:invalid + .input-unit {\n                 color: #dc3545;\n             }\n\n             /* 输入框占位符样式 */\n             .text-size-input::placeholder,\n             .icon-size-input::placeholder {\n                 color: #adb5bd;\n                 font-style: italic;\n                 opacity: 0.7;\n             }\n\n            .icon-selector {\n                display: flex;\n                gap: 8px;\n                align-items: center;\n                flex-wrap: wrap;\n            }\n\n            .icon-option {\n                width: 40px;\n                height: 40px;\n                border: 2px solid #e0e6ed;\n                border-radius: 8px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n                background-size: 24px 24px;\n                background-repeat: no-repeat;\n                background-position: center;\n                background-color: white;\n            }\n\n            .icon-option:hover {\n                border-color: #007bff;\n                transform: translateY(-2px);\n                box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);\n            }\n\n            .icon-option.selected {\n                border-color: #007bff;\n                background-color: #e7f3ff;\n                box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);\n            }\n\n            .settings-modal-footer {\n                padding: 20px 24px;\n                border-top: 1px solid #f0f0f0;\n                display: flex;\n                justify-content: flex-end;\n                gap: 12px;\n                background: white;\n                border-radius: 0 0 12px 12px;\n            }\n\n            .settings-btn-cancel {\n                padding: 10px 20px;\n                border: 1px solid #e0e6ed;\n                background: #f8f9fa;\n                color: #6c757d;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 14px;\n                font-weight: 500;\n                transition: all 0.2s ease;\n                min-width: 80px;\n            }\n\n            .settings-btn-cancel:hover {\n                background: #e9ecef;\n                color: #495057;\n                transform: translateY(-1px);\n            }\n\n            .settings-btn-save {\n                padding: 10px 20px;\n                border: none;\n                background: #007bff;\n                color: white;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 14px;\n                font-weight: 500;\n                transition: all 0.2s ease;\n                min-width: 80px;\n            }\n\n            .settings-btn-save:hover {\n                background: #0056b3;\n                transform: translateY(-1px);\n                box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);\n            }\n        ",document.head.appendChild(t)}show(){this.createPopup(),this.updateContent(),this.popup&&this.popup.show()}hide(){this.popup&&this.popup.hide()}updateContent(){this.updateCategoryList(),this.selectedCategory&&this.updateCategoryDetail(this.selectedCategory)}async updateCategoryList(){if(!this.categoryTree)return;const e=(await s.getConfig()).categories||[],t={id:"-1",label:"根目录",children:this.buildTreeData(e),expanded:this.expandedNodes.has("-1")};this.categoryTree.setData([t]),this.selectedCategory&&setTimeout(()=>{this.selectTreeNode(this.selectedCategory)},0)}buildTreeData(e){const t=[],n=new Map;return e.forEach(e=>{const t=e.name.split("/"),s=t.length>1?t[t.length-1]:e.name,i={id:e.name,label:s,children:[],expanded:this.expandedNodes.has(e.name),data:e};n.set(e.name,i)}),e.forEach(e=>{const s=n.get(e.name);if(!s)return;const i=e.name.split("/");if(i.length>1){const e=i.slice(0,-1).join("/"),o=n.get(e);o?o.children.push(s):t.push(s)}else t.push(s)}),t}selectTreeNode(e){if(!this.categoryTree)return;const t=this.categoryTree.querySelector(`[data-node-id="${e}"]`);t&&t.click()}selectCategory(e){this.selectedCategory=e,this.updateCategoryList(),this.updateCategoryDetail(e)}async updateCategoryDetail(e){if(!this.categoryDetailContainer)return;const t=await s.getCategory(e);if(!t)return void(this.categoryDetailContainer.innerHTML='<div style="text-align: center; color: #999; padding: 40px 20px;">目录不存在</div>');this.categoryDetailContainer.innerHTML="";const n=this.createCategoryDetailContent(e,t);this.categoryDetailContainer.appendChild(n)}createCategoryDetailContent(e,t){const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.gap="16px";const s=new r;s.setLabel("目录名称"),s.setValue(e.split("/").pop()||""),s.dataset.setting="name",n.appendChild(s);const i=document.createElement("div");i.style.display="grid",i.style.gridTemplateColumns="1fr 1fr",i.style.gap="16px";const o=this.createTextStyleField(e,t),a=this.createTextSizeField(e,t),l=this.createTextBoldField(e,t),c=this.createTextColorField(e,t),d=this.createTextStrokeColorField(e,t),h=this.createTextStrokeWidthField(e,t),p=this.createIconField(e,t),u=this.createIconSizeField(e,t);return i.appendChild(p),i.appendChild(u),i.appendChild(o),i.appendChild(a),i.appendChild(l),i.appendChild(c),i.appendChild(d),i.appendChild(h),n.appendChild(i),n}async deleteCategory(e){const{Confirm:t}=await a(async()=>{const{Confirm:e}=await import("./map-B5t8AdmZ.js").then(e=>e.C);return{Confirm:e}},__vite__mapDeps([0,1]),import.meta.url),{Toast:n}=await a(async()=>{const{Toast:e}=await import("./map-B5t8AdmZ.js").then(e=>e.c);return{Toast:e}},__vite__mapDeps([0,1]),import.meta.url);if(await t.show(`确定要删除类别 "${e}" 吗？\n\n此操作将同时删除该类别下的所有点位，且无法撤销。`))try{const t=await s.deleteCategory(e);this.selectedCategory===e&&(this.selectedCategory=null,this.categoryDetailContainer&&(this.categoryDetailContainer.innerHTML='<div style="text-align: center; color: #999; padding: 40px 20px;">请选择左侧目录查看详情</div>')),this.updateContent(),n.success(`成功删除类别 "${e}"，共删除了 ${t} 个点位`),this.onConfigChanged()}catch(i){n.error("删除类别失败，请重试")}}createIconSizeField(e,t){const n=(new l).setLabel("图标大小").setValue(t.iconSize||32).setMin(12).setMax(128).setPlaceholder("30");return n.dataset.setting="iconSize",n}createTextStrokeWidthField(e,t){const n=(new l).setLabel("描边宽度").setValue(t.textStrokeWidth||0).setMin(0).setMax(5).setStep(.1).setPlaceholder("0");return n.dataset.setting="textStrokeWidth",n}createTextStrokeColorField(e,t){const n=u.create().setLabel("描边颜色").setColor(t.textStrokeColor||"#000000").onChange(e=>{});return n.dataset.setting="textStrokeColor",n}createTextColorField(e,t){const n=u.create().setLabel("文本颜色").setColor(t.textColor||"#000000").onChange(e=>{});return n.dataset.setting="textColor",n}createTextBoldField(e,t){const n=p.create().setLabel("文本粗体").setChecked(t.textBold||!1).onChange(e=>{});return n.dataset.setting="textBold",n}createTextSizeField(e,t){const n=(new l).setLabel("文本大小").setValue(t.textSize||12).setMin(8).setMax(24).setPlaceholder("12");return n.dataset.setting="textSize",n}createAccumulationPointField(e,t){const n=new r;return n.setLabel("积水点"),n.setValue(t.accumulationPoint||""),n.setPlaceholder("请输入积水点信息"),n.setAttribute("data-category",e),n.addEventListener("change",e=>{}),n}createTextStyleField(e,t){const n=(new c).setLabel("文本内容").setOptions([{value:"none",text:"不显示"},{value:"code",text:"编号"},{value:"name",text:"名称"},{value:"code-name",text:"编号+名称"}]).setValue(t.textStyle||"none");return n.dataset.setting="textStyle",n}createIconField(e,t){var n,i;const o=s.getIcons(),r=o.map(e=>({name:e.name,className:e.path,title:e.name})),a=(null==(n=o.find(e=>e.path===t.iconPath))?void 0:n.name)||(null==(i=r[0])?void 0:i.name)||"",l=g.create().setLabel("图标选择").setIconList(r).setSelectedIcon(a).setColumns(5).setIconSize(24).setContainerBorder("none").onChange(e=>{});return l.dataset.setting="iconPath",l.style.gridColumn="1 / -1",l}async addNewCategory(){var e;try{const t=null==(e=this.categoryTree)?void 0:e.getSelectedNode();if(!t)return void d.show("请先选择一个目录。","info");const n="-1"===t.id?"根目录":`"${t.label}"`,i=await h.show(`请输入新类别的名称（将创建在 ${n} 下）：`,"新增类别","类别名称","");if(!i)return;const o="-1"===t.id?i:`${t.id}/${i}`;if(await s.existCategory(o))return void d.show("类别名称已存在，请使用其他名称","error");if(i.includes("/"))return void d.show('类别名称不能包含 "/" 字符。',"error");const r=s.getDefaultCategory(o);await s.addCategory(r),this.selectCategory(o),this.updateContent(),this.onConfigChanged(),d.show(`类别 "${o}" 已添加`,"success")}catch(t){d.show("添加新类别时出错","error")}}async moveCategoryUp(){this.selectedCategory?(await s.moveCategory(this.selectedCategory,"up"),this.updateContent(),this.onConfigChanged()):d.show("请先选择一个目录。","info")}async moveCategoryDown(){this.selectedCategory?(await s.moveCategory(this.selectedCategory,"down"),this.updateContent(),this.onConfigChanged()):d.show("请先选择一个目录。","info")}async renameCategory(e,t){try{const n=await s.getCategory(e);if(!n)return void d.show("目录不存在","error");await s.deleteCategory(e);const i={...n,name:t};await s.addCategory(i),this.selectedCategory=t,this.updateContent(),d.show("目录重命名成功","success")}catch(n){d.show("重命名目录失败","error")}}async saveSettings(){if(!this.selectedCategory)return void d.show("没有选中的目录可供保存。","info");const e=this.categoryDetailContainer;if(e)try{const t=e.querySelector('[data-setting="name"]'),n=e.querySelector('[data-setting="iconPath"]'),i=e.querySelector('[data-setting="iconSize"]'),o=e.querySelector('[data-setting="textStyle"]'),r=e.querySelector('[data-setting="textSize"]'),a=e.querySelector('[data-setting="textBold"]'),l=e.querySelector('[data-setting="textColor"]'),c=e.querySelector('[data-setting="textStrokeColor"]'),h=e.querySelector('[data-setting="textStrokeWidth"]');if(!(t&&n&&i&&o&&r&&a&&l&&c&&h))return void d.show("无法找到所有配置项，无法保存。","error");const p=t.getValue(),u=this.selectedCategory,g=u.split("/"),x=g.pop(),y=g.join("/"),f=y?`${y}/${p}`:p;if(f!==u&&await s.existCategory(f))return d.show(`目录名称 "${p}" 在当前目录下已存在。`,"error"),void t.setValue(x||"");const m=n.getSelectedIcon(),b=s.getIcons().find(e=>e.name===m);if(!b)return void d.show("选择的图标无效。","error");const C=await s.getConfig(),v=C.categories.findIndex(e=>e.name===u);if(-1===v)return void d.show("原始目录未找到，无法保存。","error");if(C.categories[v]={...C.categories[v],name:f,iconPath:b.path,iconSize:i.getValue()||32,textStyle:o.getValue(),textSize:r.getValue()||12,textBold:a.isChecked(),textColor:l.getColor(),textStrokeColor:c.getColor(),textStrokeWidth:h.getValue()||0},f!==u){const e=u+"/";C.categories.forEach(t=>{t.name.startsWith(e)&&(t.name=f+t.name.substring(u.length))}),this.selectedCategory=f}await s.setConfig(C),await this.updateContent(),this.onConfigChanged(),d.show("设置已保存","success")}catch(t){d.show("保存设置失败","error")}else d.show("无法找到详情面板，无法保存。","error")}};f.instance=null;let m=f;export{m as CategoryDialog};
